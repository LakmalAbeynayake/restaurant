var positems={},site={base_url:"http://localhost/inventry_pos/",mousedown_x:"",mousedown_y:"",mouseup_x:"",mouseup_y:"",settings:{logo:"logo2.png",logo2:"logo3.png",site_name:"Stock Manager Advance",language:"english",default_warehouse:"1",accounting_method:"0",default_currency:"USD",default_tax_rate:"1",rows_per_page:"10",version:"3.0.1.20",default_tax_rate2:"1",dateformat:"5",sales_prefix:"SALE",quote_prefix:"QUOTE",purchase_prefix:"PO",transfer_prefix:"TR",delivery_prefix:"DO",payment_prefix:"IPAY",return_prefix:"RETURNSL",expense_prefix:null,item_addition:"0",theme:"default",product_serial:"1",default_discount:"1",product_discount:"1",discount_method:"1",tax1:"1",tax2:"1",overselling:"0",iwidth:"800",iheight:"800",twidth:"60",theight:"60",watermark:"0",smtp_host:"pop.gmail.com",bc_fix:"4",auto_detect_barcode:"1",captcha:"0",reference_format:"2",racks:"1",attributes:"1",product_expiry:"0",decimals:"2",decimals_sep:".",thousands_sep:",",invoice_view:"0",default_biller:null,rtl:"0",each_spent:null,ca_point:null,each_sale:null,sa_point:null,sac:"0",qty_decimals:"2",display_all_products:"0",printable:!1},dateFormats:{js_sdate:"dd/mm/yyyy",php_sdate:"d/m/Y",mysq_sdate:"%d/%m/%Y",js_ldate:"dd/mm/yyyy hh:ii",php_ldate:"d/m/Y H:i",mysql_ldate:"%d/%m/%Y %H:%i"}},pos_settings={pos_id:"1",cat_limit:"22",pro_limit:"20",default_category:"1",default_customer:"1",default_biller:"3",display_time:"1",cf_title1:"GST Reg",cf_title2:"VAT Reg",cf_value1:"123456789",cf_value2:"987654321",receipt_printer:"BIXOLON SRP-350II",cash_drawer_codes:"x1C",focus_add_item:"Ctrl+F3",add_manual_product:"Ctrl+Shift+M",customer_selection:"Ctrl+Shift+C",add_customer:"Ctrl+Shift+A",toggle_category_slider:"Ctrl+F11",toggle_subcategory_slider:"Ctrl+F12",cancel_sale:"F4",suspend_sale:"F7",print_items_list:"F9",finalize_sale:"F8",today_sale:"Ctrl+F1",open_hold_bills:"Ctrl+F2",close_register:"Ctrl+F10",keyboard:"1",pos_printers:"BIXOLON SRP-350II, BIXOLON SRP-350II",java_applet:"0",product_button_color:"default",tooltips:"1",paypal_pro:"0",stripe:"0",rounding:"0",char_per_line:"42",pin_code:null,extra_charges:10},lang={unexpected_value:"Unexpected value provided!",select_above:"Please select above first",r_u_sure:"Are you sure?"},count=$("#count").val(),rowCount=$("#posTable > tbody > tr").length;function open_tab(t){$('a[href="#'+t+'"]').tab("show")}function widthFunctions(t){var e=$(window).height(),a=$("#left-top").height(),i=$("#left-bottom").height();$(".item-list").css("height",e-112),$(".item-list").css("min-height",534),$(".item-list").css("margin-right",-17),$("#left-middle").css("height",e-a-i-150),$("#left-middle").css("min-height",200),$("#product-list").css("height",e-a-i-117),$("#product-list").css("min-height",232),$("#cpinner").css("min-height",534),$(".select2-container").css("width","100%")}setInterval(function(){$(".alert").hide("blind",{},500)},15e3),setInterval(function(){if("undefined"!=typeof moment){var t=new moment;$("#display_time").text(t.format(site.dateFormats.js_sdate.toUpperCase()+" HH:mm")),$("#sale_datetime").val(t.format("Y-MM-D HH:mm:ss"))}},1e3),$(document).ready(function(){$(".auto").autoNumeric("init"),$("#poswarehouse").select2({allowClear:!0,minimumResultsForSearch:1/0}),$("#table_id").select2({allowClear:!0,minimumResultsForSearch:1/0}),$("#poscustomer").select2({allowClear:!0}).change(function(){$("#bill_customer").text("Customer:"+$("#poscustomer").select2("data").text.split("-")[0].replace("-",""))}),$("#category").select2({allowClear:!0}),$('input[type="checkbox"].red, input[type="radio"].red').iCheck({checkboxClass:"icheckbox_minimal-red",radioClass:"iradio_minimal-red"}),$('input[type="checkbox"].green, input[type="radio"].green').iCheck({checkboxClass:"icheckbox_minimal-green",radioClass:"iradio_minimal-green"}),$('input[type="checkbox"].orange, input[type="radio"].orange').iCheck({checkboxClass:"icheckbox_minimal-orange",radioClass:"iradio_minimal-orange"}),$('input[type="checkbox"].divi_1, input[type="radio"].divi_1').iCheck({checkboxClass:"icheckbox_minimal-orange",radioClass:"iradio_minimal-orange"}),$('input[type="checkbox"].divi_2, input[type="radio"].divi_2').iCheck({checkboxClass:"icheckbox_minimal-orange",radioClass:"iradio_minimal-orange"}),$("#bill_customer").text("Customer:"+$("#poscustomer").select2("data").text.split("-")[0].replace("-","")),$("#add_item").focus(),$("#modal-loading").hide(),localStorage.clear(),localStorage.setItem("reload",1),$(window).resize(),widthFunctions(),setInterval(function(){loadDelivery()},5e3)}).ajaxStart(function(){}).ajaxStop(function(){}).on("change",".rquantity",function(){var t=$(this).closest("tr");if(is_numeric($(this).val())&&0!=parseFloat($(this).val())){var e=$(t).attr("data-item-id");$("#item_count-"+e).text($(this).val()),grand_total_cal()}else $(this).val(1)}).on("keypress",".rquantity",function(t){"Escape"==t.key&&-1!=t.target.id.indexOf("quantity")&&($(this).closest("tr").remove(),$("#add_item").focus());"Enter"==t.key?$("#add_item").focus():grand_total_cal()}).on("keyup",".rquantity",function(){if(!is_numeric($(this).val())||$(this).val()<0)return $(this).val(1).focus().select(),!1;grand_total_cal()}).on("click",".rquantity",function(){setTimeout(function(){$(this).select()},2e3)}).on("click","#reset",function(){return bootbox.confirm({size:"small",message:"Are you sure?",callback:function(t){1==t&&($("#posTable tbody").empty(),grand_total_cal(0),$("input#posdiscount").val(0),$("#tds").text(0),$("input#posshipping").val(0),$("#tship").text(0),localStorage.clear(),form_clear(),form_locate())}}),!1}).bind("keyup",function(t){if("select2-input"==t.target.classList[0]){var e=t.target.value;isNaN(e)||$("#customer_mobile").val(t.target.value)}"Enter"==t.key&&("select2-input"==t.target.classList[0]&&$(".select2-results > li").hasClass("select2-no-results")&&($("#modal_ajax_customers_btn").click(),$("#select2-drop").slideUp("fast")),-1!=t.target.id.indexOf("c_pay_amount_")&&set_as_paid(t.target.attributes["sale-id"].value),"amount_1"==t.target.id&&($("#pay_amount").val(remove_comma($("#amount_1").val())),$("#submit-sale").click()),"swipe_1"==t.target.id&&t.target.value&&$("#pcc_no_1").focus(),"pcc_no_1"==t.target.id&&(t.target.value&&$("#pay_amount").val(remove_comma($("#amount_1").val())),$("#submit-sale").click()),"pcc_holder_1"==t.target.id&&(t.target.value&&$("#pay_amount").val(remove_comma($("#amount_1").val())),$("#submit-sale").click()))}).keypress(function(t){"'"==String.fromCharCode(t.which)&&(t.preventDefault(),displayNotice("page"," Character you typed is not allowed !! ")),!0===t.ctrlKey&&("1"==t.key?(t.preventDefault(),open_tab("Sales")):"2"==t.key?(t.preventDefault(),open_tab("dine_in")):"3"==t.key?(t.preventDefault(),open_tab("take_away")):"4"==t.key?(t.preventDefault(),open_tab("delivery")):"5"==t.key&&(t.preventDefault(),open_tab("add_product")))}),$("#add_item").autocomplete({source:jsonarray,minLength:1,autoFocus:!1,delay:200,response:function(t,e){16<=$(this).val().length&&0==e.content[0].id?($(this).val(""),$("#add_item").val("").removeClass("ui-autocomplete-loading")):1==e.content.length&&0!=e.content[0].id||1==e.content.length&&0==e.content[0].id&&($(this).val(""),$("#add_item").val("").removeClass("ui-autocomplete-loading"))},select:function(t,e){(t.preventDefault(),0!==e.item.id)?(add_invoice_item(e.item,"")&&$(this).val(""),$("#add_item").val("").removeClass("ui-autocomplete-loading")):bootbox.alert("No matching result found! Product might be out of stock in the selected warehouse.")}}),$("#poswarehouse").change(function(t){localStorage.setItem("poswarehouse",$(this).val())}),$("#poscustomer").change(function(t){localStorage.setItem("poscustomer",$(this).val())}),$("#clearLS").click(function(){localStorage.clear(),localStorage.setItem("clear",1)}),$("#add_item").bind("keypress",function(t){13==t.keyCode&&(t.preventDefault(),$("#payment").click(),$(this).autocomplete("search"))}),$("#posTable").bind("keypress",function(t){t.shiftKey,"Backspace"!=t.key&&(t.which<46||57<t.which?t.preventDefault():t.which<93||t.which)}),$(".open-category").click(function(){$("#category-slider").toggle("slide",{direction:"right"},300)}),$(".open-subcategory").click(function(){$("#subcategory-slider").toggle("slide",{direction:"right"},300)}),$(".open-keyboard").click(function(){$("#keyboard-slider").toggle("slide",{direction:"right"},300)}),$("input[type=text] select").focus(function(){""!=this.id&&$("#id-name").val(this.id)}),$("#modal_ajax_customers_btn").click(function(t){t.preventDefault();var e=$("#ajax-modal").modal();e.load(base_url+"customers/create_customers","",function(){e.modal(),setTimeout(function(){var t=$("#customer_mobile").val();$("#cus_phone").val(t),$("#nc").val(2),$("#cus_name").focus()},500)})}),$(window).bind("resize",widthFunctions);var osub_cat_id,product_variant=0,shipping=0,p_page=0,per_page=0,tcp="8",cat_id="8",ocat_id="1",sub_cat_id=0,base_url=$("#base_url").val();function add_products_to_pos_table(t){var e;e=t.target.id;var a,i,o={},s=(a=1e3,i=9999,Math.floor(Math.random()*(i-a+1)+a)),n=$("#"+e).attr("value")+"|"+$("#"+e).attr("data-original-title"),l=$("#"+e).attr("value"),c=$("#"+e).attr("product_id"),r=$("#"+e).attr("data-original-title"),d=$("#"+e).attr("product_price");$("#"+e).attr("value");o.id=s,o.label=n,o.product_code=l,o.product_id=c,o.product_name=r,o.product_price=d,o.value=r,add_invoice_item(o,"")}function isAddedProduct(t){if($("#product_id_"+t).val()){var e="#quantity_"+$("#product_id_"+t).attr("row_id"),a=parseFloat($(e).val());return $(e).val(a+1),$("#item_count-"+t).text(a+1),grand_total_cal(),1}}function add_invoice_item(t,e){var a=t[0];if(a&&(a.editable="readonly"),!(1!=++rowCount||$("#poswarehouse").val()&&$("#poscustomer").val()))return bootbox.alert(lang.select_above),t=null,!1;if(null==t)return!1;var i="";rowCount&&(i=isAddedProduct(t.product_id)),i||($("#count").val(++count),void 0!==t[0]?loadItemsDef(t):loadItems(t))}function loadItems(t){$("#item_count-"+t.product_id).text(1).show();var e,a=$("#count").val(),i=$('<tr id="row_'+a+'" class="row_'+a+'" data-item-id="'+t.product_id+'"></tr>');e='<td><input type="hidden" value="'+t.product_id+'" class="rid" name="product_id[]" id="product_id_'+t.product_id+'" row_id="'+a+'"><input type="hidden" value="'+t.product_code+'" class="rcode" name="product_code[]"><input type="hidden" value="'+t.product_name+'" class="rname" name="product_name[]">'+t.label+"</td>",e+='<td class="text-right"><input class="form-control input-sm text-center rquantity rprice" style="width:100%;cursor:pointer" type="text" type="text" value="'+t.product_price+'" id="sprice_'+a+'" name="net_price[]" ondblclick="enable_(this)" onclick="this.select" onblur="disable_(this)" readonly></td>"',e+='<td><input type="number" role="textbox" tabIndex="'+a+'" aria-haspopup="true" class="form-control input-sm text-center rquantity " name="quantity[]" value="1" data-item="'+t.product_id+'" id="quantity_'+a+'" onclick="this.select"></td>',e+=' <td class="text-right"><input type="hidden" value="'+t.product_price+'" id="ssubtotal_'+a+'" name="ssubtotal[]"><span class="text-right ssubtotal" id="subtotal_'+a+'">'+formatMoney(t.product_price)+"</span></td>",e+='<td style="background-color:orange" class="text-center posdel" onClick="delRow('+a+')" ><i class="fa fa-times tip pointer " id="1451881153671" title="Remove" style="cursor:pointer;"></i></td>',i.html(e),i.prependTo("#posTable"),create_bill(a,t.product_name,t.product_price),grand_total_cal()}function loadItemsDef(t){console.log(t[0].editable);var e,a=$("#count").val(),i=$('<tr id="row_'+a+'" class="row_'+a+'" data-item-id="'+t[0].product_id+'"></tr>');e='<td><input type="hidden" value="'+t[0].product_id+'" class="rid" name="product_id[]" id="product_id_'+t[0].product_id+'" row_id="'+a+'"><input type="hidden" value="'+t[0].product_code+'" class="rcode" name="product_code[]"><input type="hidden" value="'+t[0].product_name+'" class="rname" name="product_name[]">'+t[0].label+"</td>",e+='<td class="text-right"><input class="form-control input-sm text-center rquantity rprice" '+t[0].editable+' style="width:100%" type="text" type="text" value="'+t[0].product_price+'" id="sprice_'+a+'" name="net_price[]" ondblclick="enable_(this)" onclick="this.select" onblur="disable_(this)" readonly></td>"',e+='<td><input type="number" role="textbox" tabIndex="'+a+'" aria-haspopup="true" class="form-control input-sm text-center rquantity " '+t[0].editable+' name="quantity[]" value="'+parseInt(t[0].qty)+'" data-id="1451881153671" data-item="'+t[0].product_id+'" id="quantity_'+a+'" onclick="this.select;"></td>',e+='<td class="text-right"><input type="hidden" value="'+t[0].product_price+'" id="ssubtotal_'+a+'" name="ssubtotal[]"><span class="text-right ssubtotal" id="subtotal_'+a+'">'+formatMoney(parseInt(t[0].qty)*t[0].product_price)+"</span></td>",e+='<td style="background-color:orange" class="text-center posdel" onClick="delRow('+a+')"><i class="fa fa-times tip pointer " id="1451881153671" title="Remove" style="cursor:pointer;"></i></td>',i.html(e),i.prependTo("#posTable"),create_bill(a,t[0].product_name,t[0].product_price),grand_total_cal(),$("#quantity_"+a).focus().select()}function create_bill(t,e,i){a=$('<tr class="text-right bill_content\tbill_tr_id'+t+'"></tr>'),f='<td class="text-center">*</td>',f+='<td style="text-align:left">'+e+"</td>",f+='<td class="text-center\tbill_td_qty_'+t+'">1</td>',f+='<td class="text-right \tbill_td_price_'+t+'" id="">'+i+"</td>",f+='<td class="text-right\t\tbill_td_amount_'+t+'">'+i+"</td>",a.html(f),a.prependTo("#bill_table"),a=$('<tr class="text-right \tbill_tr_id'+t+'"></tr>'),f='<td class="text-center">*</td>',f+='<td style="text-align:left">'+e+"</td>",f+='<td class="text-center\tbill_td_qty_'+t+'">1</td>',a.html(f),a.prependTo("#kot_table"),a.prependTo("#kot_table_print")}function enable_(t){$(t).attr("readonly",!1)}function disable_(t){$(t).attr("readonly",!0)}function delRow(t){$(".bill_tr_id"+t).remove(),$("#item_count-"+t).text(0).hide(),delete positems[t],localStorage.setItem("positems",JSON.stringify(positems))}$(document).on("click",".posdel",function(t){$(this).closest("tr").remove(),grand_total_cal()}).on("click","#submit-sale",function(){site.settings.printable=!0,$("#submit-sale").attr("disabled",!0),$("#paymentModal").modal("hide"),form_submit()}).on("click","#save",function(){if(0<$("#posTable >tbody > tr").length){var t=$('.cb_list input[type="radio"]:checked:first').val(),e=$("#shipping_address").val(),a=$("#posshipping").val();if(3==t)""==e?($("#pshipping").click(),displayNotice("","Please confirm and update delivery details !!")):0==a?bootbox.confirm({size:"small",message:" Delivery charges : Rs. 0.00 /=. Continue ?",callback:function(t){1==t||$("#pshipping").click()}}):(site.settings.printable,form_submit_for_kot());else if(1==t){""==$("#table_id").val()?bootbox.alert("Please select table number!"):(site.settings.printable,form_submit_for_kot())}else site.settings.printable,form_submit_for_kot()}else displayNotice("","Please add product before payment. Thank you !! "),$("#add_item").focus()}).on("click",function(t){if($(t.target).is(".open-category, .cat-child")||$(t.target).parents("#category-slider").size()||!$("#category-slider").is(":visible")||$("#category-slider").toggle("slide",{direction:"right"},500),$(t.target).is(".open-subcategory, .cat-child")||$(t.target).parents("#subcategory-slider").size()||!$("#subcategory-slider").is(":visible")||$("#subcategory-slider").toggle("slide",{direction:"right"},200),!$(t.target).is(".open-keyboard")){var e=document.activeElement;""!=e.id&&$("#id-name").val(e.id)}}).on("mousedown",".product",function(t){var e=t.clientX,a=t.clientY;site.mousedown_x=e,site.mousedown_y=a}).on("mouseup",".product",function(t){var e=t.clientX;t.clientY;site.mousedown_x==e&&add_products_to_pos_table(t)});var itemQty=0;function grand_total_cal(t){var e=$("input:radio[name='delivery_status']:checked").val(),a=0,i=0;for(t=0;t<=count;t++){var o=$("#sprice_"+t).val();if(o){$(".bill_td_price_"+t).text(o);var s=$("#quantity_"+t).val();$(".bill_td_qty_"+t).html(s);var n=(o=remove_comma(o))*s;a+=n,$("#subtotal_"+t).text(formatMoney(n)),$("#ssubtotal_"+t).val(parseFloat(n)),$(".bill_td_amount_"+t).text(formatMoney(n))}}var l=$("span#tds").text();if(0<parseInt(l))if($("#td_order_discount").parent().removeClass("no-print"),$("#td_order_discount").parent().css("display",""),$("#td_order_discount").text("("+l+")"),-1!==l.indexOf("%")){var c=l.split("%");i=isNaN(c[0])?formatDecimal(l):formatDecimal(a*parseFloat(c[0])/100)}else i=formatDecimal(l);else $("#td_order_discount").parent().addClass("no-print"),$("#td_order_discount").parent().css("display","none");$("span#total").text(formatMoney(a)),$(".td_sub_total").text(formatMoney(a));var r=0;1==e?(r+=formatDecimal(a*pos_settings.extra_charges/100),$("#extra_charges").val(pos_settings.extra_charges+"%"),$("#extra_charges_amount").val(r),$("#sc_sp").html("(S.C "+pos_settings.extra_charges+"% included)"),$("#sc_sp").css("visibility","visible"),$("#td_service_charges").parent().removeClass("no-print"),$("#td_service_charges").text(formatMoney(r)),$("#td_service_charges").parent().css("display","")):($("#extra_charges").val(""),$("#extra_charges_amount").val(),$("#sc_sp").css("visibility","hidden"),$("#td_service_charges").parent().addClass("no-print"),$("#td_service_charges").parent().css("display","none")),(itemQty=$("#posTable >tbody > tr").length)<1&&$("#sc_sp").css("visibility","hidden"),a+=r,$("input#amount_val_1").val(a-i),$("input#posdiscount").val(i),$("span#titems").text(itemQty);var d=$("#posshipping").val();3==e?(d||(d=0),$("span#tship").text(formatMoney(d)),$("#td_delivery_charges").parent().removeClass("no-print"),$("#td_delivery_charges").text(formatMoney(d)),$("#td_delivery_charges").parent().css("display","")):($("#posshipping").val("0"),$("#shipping_address").val(""),d=0,$("#td_delivery_charges").parent().addClass("no-print"),$("#td_delivery_charges").parent().css("display","none")),$("span#gtotal").text(formatMoney(a-i+parseInt(d))),$(".id_total_amount").text(formatMoney(a-i+parseInt(d))),localStorage.setItem("gtotal",formatMoney(a-i+parseInt(d))),$("#grand_total").val(a-i+parseInt(d))}function load_payment_grid(){$("span#twt").text($("span#gtotal").text()),$("span#item_count").text($("span#titems").text()),$("#paymentModal").modal()}function calculateTotals(){console.log("calculateTotals....");var a=0,t=remove_comma($("span#twt").text()),e=$(".amount");$.each(e,function(t){var e=remove_comma($(this).val());a+=parseFloat(e||0)}),$("#total_paying").text(formatMoney(a)),$("#td_paying_amount").text(formatMoney(a)).parent().css("display",""),$("#td_paying_by").text($("#paid_by_1").val()),$("#balance").text(formatMoney(a-t)),0<=a-t&&$("#td_balance_amount").text(formatMoney(a-t)).parent().parent().css("display",""),total_paid=a,grand_total=t}function getAddressByCusId(){var e="",t=$("#poscustomer").val();$.ajax({type:"get",url:base_url+"pos/get_customers",data:{srh_customer_id:t},dataType:"json",success:function(t){if(null!==t)return e=t[0].cus_address,$("#address_input").val(e),$("#sModal").modal(),e;bootbox.alert("No result found!")}})}function displayNotice(t,e){return $.gritter.add({title:"Notice!",text:e,image:"",sticky:!1,time:"100"}),!1}function printElem(t){document.getElementById(t).innerHTML;var e=window.open("","Print","height=1,width=1");return e.document.close(),e.focus(),e.print(),e.close(),!0}function remove_comma(t){return parseFloat(t.replace(/,/g,""))}function formatDecimal(t){return parseFloat(parseFloat(t).toFixed(site.settings.decimals))}function formatMoney(t,e){return e||(e=""),1==site.settings.sac?e+""+formatSA(parseFloat(t).toFixed(site.settings.decimals)):accounting.formatMoney(t,e,site.settings.decimals,0==site.settings.thousands_sep?" ":site.settings.thousands_sep,site.settings.decimals_sep,"%s%v")}function getNumber(t){return accounting.unformat(t)}function formatQuantity(t){return null!=t?'<div class="text-center">'+formatNumber(t,site.settings.qty_decimals)+"</div>":""}function formatNumber(t,e){return e||0==e||(e=site.settings.decimals),1==site.settings.sac?formatSA(parseFloat(t).toFixed(e)):accounting.formatNumber(t,e,0==site.settings.thousands_sep?" ":site.settings.thousands_sep,site.settings.decimals_sep)}function formatMoney(t,e){return e||(e=""),1==site.settings.sac?e+""+formatSA(parseFloat(t).toFixed(site.settings.decimals)):accounting.formatMoney(t,e,site.settings.decimals,0==site.settings.thousands_sep?" ":site.settings.thousands_sep,site.settings.decimals_sep,"%s%v")}function formatDecimal(t){return parseFloat(parseFloat(t).toFixed(site.settings.decimals))}function is_valid_discount(t){return!(!is_numeric(t)&&!/([0-9]%)/i.test(t))}function is_numeric(t){return("number"==typeof t||"string"==typeof t&&-1===" \n\r\t\f\v            ​\u2028\u2029　".indexOf(t.slice(-1)))&&""!==t&&!isNaN(t)}function is_float(t){return!(+t!==t||isFinite(t)&&!(t%1))}function currencyFormat(t){return null!=t?formatMoney(t):"0"}function formatSA(t){var e="";0<(t=t.toString()).indexOf(".")&&(e=t.substring(t.indexOf("."),t.length));var a=(t=(t=Math.floor(t)).toString()).substring(t.length-3),i=t.substring(0,t.length-3);return""!=i&&(a=","+a),i.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a+e}$("#ppdiscount").click(function(t){t.preventDefault(),$("#dsModal").modal()}),$("#dsModal").on("shown.bs.modal",function(){$(this).find("#order_discount_input").select().focus(),$("input#order_discount_input").bind("keypress",function(t){if(13==t.keyCode){t.preventDefault();var e=$("#order_discount_input").val()?$("#order_discount_input").val():"0";is_valid_discount(e)?(is_valid_discount(e)?($("#tds").text(formatMoney(e)),$("#posdiscount").val(e),localStorage.removeItem("posdiscount"),localStorage.setItem("posdiscount",e),$("#pos_discount_input1").val(e)):bootbox.alert(lang.unexpected_value),$("#dsModal").modal("hide"),grand_total_cal()):bootbox.alert(lang.unexpected_value),$("#dsModal").modal("hide")}})}),$(document).on("click","#updateOrderDiscount",function(){var t=$("#order_discount_input").val()?$("#order_discount_input").val():"0";is_valid_discount(t)?($("#tds").text(t),$("#posdiscount").val(t),localStorage.removeItem("posdiscount"),localStorage.setItem("posdiscount",t),$("#pos_discount_input1").val(t)):bootbox.alert(lang.unexpected_value),$("#dsModal").modal("hide"),grand_total_cal()}),$("#payment").click(function(t){if(0<$("#posTable >tbody > tr").length){var e=$('.cb_list input[type="radio"]:checked:first').val(),a=$("#shipping_address").val(),i=$("#posshipping").val();if(3==e)""==a?($("#pshipping").click(),displayNotice("","Please confirm and update delivery details !!")):0==i?bootbox.confirm({size:"small",message:" Delivery charges : Rs. 0.00 /=. Continue ?",callback:function(t){1==t?load_payment_grid():$("#pshipping").click()}}):load_payment_grid();else if(1==e)""==$("#table_id").val()?bootbox.alert("Please select table number !"):load_payment_grid();else load_payment_grid()}else displayNotice("","Please add product before payment. Thank you !! "),$("#add_item").focus()}),$("#paymentModal").on("shown.bs.modal",function(){$("#paid_by_1").val("cash").trigger("change"),$("input.amount").focus().select()}).on("hidden.bs.modal",function(t){$("#add_item").focus()}),$(document).on("change",".paid_by",function(){var t=$(this).val(),e=$(this).attr("id"),a=e.substr(e.length-1);$("#rpaidby").val(t),"cash"==t||"other"==t?($(".pcheque_"+a).hide(),$(".pcc_"+a).hide(),$(".pcash_"+a).show(),$("#payment_note_"+a).focus(),$("#paid_by_val_1").val(t)):"CC"==t||"stripe"==t||"ppp"==t?($(".pcheque_"+a).hide(),$(".pcash_"+a).hide(),$(".pcc_"+a).show(),$("#swipe_"+a).focus(),$("#paid_by_val_1").val(t)):"Cheque"==t?($(".pcc_"+a).hide(),$(".pcash_"+a).hide(),$(".pcheque_"+a).show(),$("#cheque_no_"+a).focus()):($(".pcheque_"+a).hide(),$(".pcc_"+a).hide(),$(".pcash_"+a).hide()),"gift_card"==t?($(".gc_"+a).show(),$(".ngc_"+a).hide(),$("#gift_card_no_"+a).focus()):($(".ngc_"+a).show(),$(".gc_"+a).hide(),$("#gc_details_"+a).html("")),calculateTotals()}).on("click",".quick-cash",function(){var t=$(this),e=t.contents().filter(function(){return 3==this.nodeType}).text(),a=$("#amount_1");e=1*formatDecimal(e.split(",").join(""))+1*remove_comma(a.val()),a.val(formatDecimal(e)).focus().change();var i=t.find("span");0==i.length?t.append('<span class="badge">1</span>'):i.text(parseInt(i.text())+1)}).on("click","#clear-cash-notes",function(){$(".quick-cash").find(".badge").remove(),$("#"+pi).val("0").focus()}).on("focus",".amount",function(){pi=$(this).attr("id"),calculateTotals()}).on("blur",".amount",function(){calculateTotals()}).on("keyup",".amount",function(){calculateTotals()}),$("#pshipping").click(function(t){t.preventDefault(),shipping=$("#posshipping").val()?$("#posshipping").val():shipping,$("#shipping_input").val(shipping),shippingAddr=$("#shipping_address").val()?$("#shipping_address").val():"",shippingAddr?($("#address_input").val(shippingAddr),$("#sModal").modal()):getAddressByCusId()}),$("#sModal").on("shown.bs.modal",function(){$(this).find("#shipping_input").select().focus(),$("input#shipping_input").bind("keypress",function(t){if(13==t.keyCode){t.preventDefault();var e=parseFloat($("#shipping_input").val()?$("#shipping_input").val():"0");is_numeric(e)?($("#posshipping").val(e),localStorage.setItem("posshipping",e),grand_total_cal(),$("#sModal").modal("hide")):bootbox.alert(lang.unexpected_value)}})}),$(document).on("click","#updateShipping",function(){var t=parseFloat($("#shipping_input").val()?$("#shipping_input").val():"0"),e=$("#address_input").val();$("#shipping_address").val(e),is_numeric(t)?($("#posshipping").val(t),localStorage.setItem("posshipping",t),grand_total_cal(),$("#sModal").modal("hide")):bootbox.alert(lang.unexpected_value)}),$("#paymentModal").on("change","#amount_1",function(t){$("#pay_amount").val(remove_comma($(this).val()))}).on("blur","#amount_1",function(t){$("#pay_amount").val(remove_comma($(this).val()))}).on("change","#payment_note_1",function(t){$("#pos_note").val($(this).val());var e=$("#pos_note").val();localStorage.setItem("posnote",e)}).on("change","#swipe_1",function(t){$("#cc_name").val($(this).val())}).on("change",".pcc_type",function(t){$("#pcc_type").val($(this).val())}).on("change","#pcc_holder_1",function(t){$("#pcc_holder").val($(this).val())}).on("change","#pcc_no_1",function(t){$("#cc_no").val($(this).val())}),$(window).keydown(function(t){t.altKey&&(1==t.key?($("#cb_1").iCheck("check"),grand_total_cal(),$("#add_item").focus()):2==t.key?($("#cb_2").iCheck("check"),grand_total_cal(),$("#add_item").focus()):3==t.key?($("#cb_3").iCheck("check"),grand_total_cal(),$("#add_item").focus()):4==t.key?$("#add_item").focus():5==t.key&&printElem("drawer"))}),$(".panel-refresh").click(function(t){t.preventDefault(),"delivery-panel-refresh"==t.target.id?loadDelivery():"takeaway-panel-refresh"==t.target.id?loadTakeaway():"dine_in-panel-refresh"==t.target.id&&loadDineIn()}),$("input.ds").on("ifChecked",function(t){1==t.target.value&&($("#content").css("background-color","#428bca"),$(".hide_me").css("visibility","hidden"),grand_total_cal()),2==t.target.value&&($("#content").css("background-color","black"),$(".hide_me").css("visibility","hidden"),grand_total_cal()),3==t.target.value&&($("#content").css("background-color","#eea236"),$(".hide_me").css("visibility","visible"),grand_total_cal())}),$("input.ds").on("ifUnchecked",function(t){$("#delivary_status").val(0),$("#content").css("background-color","#FFF")}),$("#div_1 , #div_1_2").on("click",function(){$("#cb_1").iCheck("check"),grand_total_cal()}),$("#div_2 , #div_2_2").on("click",function(){$("#cb_2").iCheck("check"),grand_total_cal()}),$("#div_3 , #div_3_2").on("click",function(){$("#cb_3").iCheck("check"),grand_total_cal()}),$("#poss_1 , #poss_1_2").on("click",function(){$("#divi_1").iCheck("check")}),$("#poss_2 , #poss_2_2").on("click",function(){$("#divi_2").iCheck("check")}),$("#view_bill").click(function(t){t.preventDefault(),$("#view_bill_modal").modal()}),$(".cat").click(function(t){var e=$(this).attr("cat_title_nme"),a=$(this).attr("cat_title_id");$("#cat_title_"+a).text(e)});